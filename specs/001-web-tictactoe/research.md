# 研究文件：網頁版井字遊戲

**Phase**: 0 - 研究 & 澄清  
**Date**: 2025-11-12  
**Status**: 完成  
**Input**: Feature Specification + Technical Context from plan.md

## 研究摘要

本研究文件解決實裝計劃中的技術不確定性，為Phase 1設計奠定基礎。

---

## 研究主題

### 研究 1: AI著法算法選擇

**問題**: 在Web環境中，使用哪種算法實現三難度級別的AI對手？

**候選方案評估**:

| 方案 | 優點 | 缺點 | 難度差異 | 採納 |
|------|------|------|--------|------|
| **Minimax (完美演奏)** | 邏輯清晰，易測試 | 計算量小但對3x3棋盤足夠 | 困難模式；簡單/中等通過隨機跳過優先級 | ✅ |
| Alpha-Beta剪枝 | 優化版Minimax | 3x3棋盤無必要 | 同上 | ❌ |
| 純隨機 | 簡單 | 無策略，容易 | 無難度區分 | ❌ |
| 規則庫 (Heuristics) | 靈活控制 | 難以維護完整 | 可調，但複雜 | ❌ |

**決策**: **Minimax算法 + 優先級邏輯**
- **簡單模式**: Minimax計算後，50%機率選擇次優著法；跳過防守優先級
- **中等模式**: Minimax計算後，80%機率選擇最優著法；遵循防守→攻擊→策略優先級
- **困難模式**: Minimax計算，100%選擇最優著法；嚴格遵循優先級

**理由**:
- Minimax邏輯簡潔，3x3棋盤計算量極小（最多5層深度，約5000個節點）
- 易於測試驗證著法正確性
- 通過隨機性實現難度區分，無需維護多套算法
- 符合專案憲法中「程式碼品質」與「可維護性」的要求

**實裝細節**:
- 時間複雜度: O(9!) 最壞情況 ≈ 100ms (JavaScript單線程，足夠)
- 空間複雜度: O(深度) ≈ O(5) 極小
- 預計執行時間: 50-100ms，滿足SC-002 (P95 ≤ 1000ms)

---

### 研究 2: Web技術棧選擇

**問題**: 使用純HTML/CSS/JavaScript，還是前端框架（React/Vue/Svelte）？

**候選方案評估**:

| 方案 | 優點 | 缺點 | 採納 |
|------|------|------|------|
| **純 HTML/CSS/JavaScript** | 無依賴，極小檔案體積，快速載入 | 需手工管理DOM更新 | ✅ |
| React | 元件化，生態大 | 增加150KB以上bundle，過度設計 | ❌ |
| Vue | 輕量級，易學 | 仍然增加80KB+，無必要 | ❌ |
| Svelte | 編譯時框架，極小運行時 | 需構建工具，學習曲線 | ❌ |

**決策**: **純 HTML/CSS/JavaScript (ES6+)**

**理由**:
- 井字遊戲UI簡單（棋盤9格 + 難度選擇 + 結果訊息），無需框架
- 符合「簡潔應用」與「快速進入」的設計哲學 (SC-001: 2秒內可互動)
- 零依賴，避免第三方庫版本管理與安全問題
- 檔案體積小 (<50KB總大小)，頁面加載迅速
- 易於測試與維護（代碼清晰）

**工具選擇**:
- 無運行時框架，但可使用開發工具鏈:
  - **Webpack/Vite**: 用於本地開發、模組打包、熱重載
  - **Jest + Babel**: 單位與集成測試
  - **ESLint + Prettier**: 代碼風格與格式化

---

### 研究 3: UI狀態管理策略

**問題**: 如何管理遊戲狀態（棋盤配置、玩家輪次、難度、結果）？

**候選方案評估**:

| 方案 | 優點 | 缺點 | 採納 |
|------|------|------|------|
| **单一狀態物件 (GameState class)** | 易於理解，易於測試，無外部依賴 | 手工同步UI | ✅ |
| Redux | 時間旅行調試，全局狀態管理 | 過度設計，複雜 | ❌ |
| MobX | 響應式狀態管理 | 仍然增加複雜度 | ❌ |
| 分散狀態 (各處亂放) | 簡單 | 易出現同步Bug | ❌ |

**決策**: **單一 GameState 類 + Manual DOM Sync**

**理由**:
- GameState類管理所有狀態 (棋盤、玩家輪次、難度、遊戲進行中/結束)
- UI控制器監聽狀態變化，手工更新DOM
- 代碼簡潔，易於單位測試狀態轉換邏輯
- 無框架依賴，與"純HTML/CSS/JavaScript"決策一致

**實裝結構**:
```
GameState:
  - board: [9] (0=空, 1=X, -1=O)
  - currentTurn: 'player'|'ai'
  - isGameOver: boolean
  - winner: 'player'|'ai'|'draw'|null
  - difficulty: 'easy'|'medium'|'hard'
  - methods: makeMove(pos), reset(), etc.

UIController:
  - 監聽GameState變化
  - 更新棋盤顯示
  - 更新難度選擇UI
  - 顯示結果訊息
```

---

### 研究 4: 測試策略與工具

**問題**: 使用什麼測試框架和策略確保遊戲邏輯正確？

**候選方案評估**:

| 工具/策略 | 適用場景 | 採納 |
|---------|--------|------|
| **Jest (單位測試)** | 遊戲邏輯、AI算法、狀態轉換 | ✅ |
| **Cypress/Playwright (E2E測試)** | 完整遊戲流程、UI交互 | ✅ |
| **簡單測試函數** | 快速驗證 | ⚠ (作為過渡) |
| **手工測試** | 探索性測試 | ❌ (無法達成覆蓋率目標) |

**測試計劃**:

1. **單位測試 (Jest)**: 目標 ≥80% 覆蓋率
   - GameBoard 邏輯: 放置棋子、檢查勝利、檢查平局
   - AIEngine: 各難度的著法選擇、優先級邏輯
   - GameState: 狀態轉換、輪次管理
   - DifficultyLevel: 難度參數驗證

2. **集成測試 (Cypress)**: 完整遊戲流程
   - 玩家著法 → AI反應 → 結果顯示
   - 難度變更 → AI行為變化
   - 邊界情況: 重複著法、棋盤滿、無效輸入

3. **邊界情況測試**:
   - 棋盤滿無人勝 → 平局判定
   - AI一步可勝時 → 立即執行
   - 玩家一步可敗時 → AI防守

**理由**: 符合憲法中「測試標準」原則，確保遊戲邏輯100%正確性

---

### 研究 5: 瀏覽器兼容性與開發工具

**問題**: 支持哪些瀏覽器？需要什麼構建與開發工具？

**決策**:

1. **瀏覽器支持**:
   - ✅ Chrome (最新版本)
   - ✅ Firefox (最新版本)
   - ✅ Safari (最新版本, macOS/iOS)
   - ✅ Edge (最新版本)
   - ⚠ Mobile 瀏覽器: 可使用但無特殊優化 (Q3澄清)

   使用 **Babel** (ES6 → ES5 轉譯，以支持舊版瀏覽器，若需要)
   使用 **Autoprefixer** (CSS前綴自動化)

2. **構建工具**:
   - **Webpack 或 Vite**: 模組打包、dev server、熱重載
   - **npm scripts**: 簡單的構建命令 (build, test, serve)

3. **開發環境**:
   - Node.js 18+ 用於開發工具
   - npm 或 yarn 用於包管理

**理由**: 平衡開發體驗與部署簡潔性

---

### 研究 6: 離線優先實裝

**問題**: 如何實現完全離線運行（FR-011）？

**決策**:

1. **無服務器依賴**: 所有遊戲邏輯 (AI、棋盤檢查、狀態管理) 運行在瀏覽器客戶端
2. **靜態資源**: index.html, CSS, JavaScript 可通過簡單的HTTP伺服器或 file:// 協議加載
3. **可選的狀態持久化** (不強制):
   - 若使用 LocalStorage，玩家可跨會話記憶難度選擇
   - 若不使用，每次刷新遊戲重置（符合規格中「無跨會話記憶」）

4. **網絡狀態監控** (可選增強):
   - 使用 `navigator.onLine` 監控網絡狀態
   - 若離線，顯示友善提示但遊戲繼續運行
   - 若恢復，提示用戶（無需特殊動作）

**實裝細節**:
- 無需 Service Worker (除非使用PWA增強)
- 無 API 調用、無資料庫連接
- 所有資源本地化

**理由**: 符合 FR-011 與 Q4 澄清 (完全離線運行)

---

## Phase 0 完成檢查清單

- [x] AI 算法選擇: Minimax + 優先級邏輯 ✅
- [x] 技術棧選擇: 純 HTML/CSS/JavaScript ✅
- [x] 狀態管理: GameState 類 ✅
- [x] 測試策略: Jest + Cypress ✅
- [x] 瀏覽器兼容性: 主流桌面瀏覽器 ✅
- [x] 離線優先設計: 無服務器依賴 ✅

**Phase 0 status**: ✅ **完成 - 所有NEEDS CLARIFICATION已解決**

---

**下一步**: 進入 Phase 1 設計，生成 data-model.md, contracts/, quickstart.md
